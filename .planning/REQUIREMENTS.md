# Requirements: NoteTree

## 1. Core Functional Requirements

### 1.1 Tree-Based Interaction (DAG)
- **Visual Branching**: Users must be able to initiate a new "branch" (child node) from any existing node (parent).
- **Infinite Canvas**: A panable and zoomable workspace using React Flow.
- **Node Persistence**: All nodes, edges, and content must be persisted locally via IndexedDB (Dexie.js).
- **Node Editing**: Users can edit node content; however, editing a parent does *not* automatically trigger re-generation of its existing children (static inheritance).

### 1.2 Context Management
- **Context Inheritance**: A child node inherits the conversation history of its direct ancestors (path to root).
- **Sliding Window Strategy**: LLM requests must include the "Root" node plus the last $N$ ancestors to balance context depth and token limits.
- **Context Isolation**: Sibling nodes must be strictly isolated from each other's conversation history.
- **Token Efficiency**: Basic local token estimation (model-specific if possible) to prevent API errors.

### 1.3 UI/UX Performance
- **Ghosting Mode**: Inactive branches (those not in the lineage of the currently selected node) should be visually dimmed.
- **Folding/Summarization**: Users can "collapse" branches. Collapsed nodes should display a summary (auto-generated by LLM) with the original content available in a tooltip.
- **Responsive Layout**: Optimized for desktop interactions (mouse wheel zoom, keyboard shortcuts).

## 2. Technical Requirements

### 2.1 Technology Stack
- **Frontend**: Vite + React + TypeScript.
- **State Management**: Zustand (flat DAG state).
- **Graph Engine**: React Flow (xyflow).
- **Persistence**: IndexedDB with Dexie.js.
- **API**: Google Gemini API (initial provider).

### 2.2 Performance Targets
- **Rendering**: Maintain 60fps during pan/zoom for up to 200 nodes.
- **Initialization**: App should load and restore the previous session in under 1 second.

## 3. Security & Privacy
- **API Keys**: Stored locally in browser storage; never transmitted to any third-party server except the LLM provider.
- **Data Privacy**: All chat data remains local to the user's browser.

## 4. MVP Scope (Phase 1)
- [ ] Basic infinite canvas with pan/zoom.
- [ ] Create nodes and branches.
- [ ] Integration with Gemini API for node generation.
- [ ] Basic lineage inheritance (full ancestor path).
- [ ] Simple LocalStorage/IndexedDB persistence.
- [ ] "Copy Branch" utility.
